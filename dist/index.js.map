{"version":3,"sources":["../src/domain/entities/Project.ts","../src/usecase/createProjectUseCase.ts","../src/domain/entities/Message.ts","../src/domain/entities/Session.ts","../src/usecase/createSessionUseCase.ts","../src/gateway/ClaudeCodeGateway.ts","../src/usecase/sendMessageUseCase.ts","../src/utils/normalizeCwd.ts","../src/index.ts"],"sourcesContent":["export interface IProject {\n  name: string\n  path: string\n}\n\nexport class Project implements IProject {\n  name: string\n  path: string\n\n  constructor(path: string, name: string) {\n    this.path = path\n    this.name = name\n  }\n}\n","import { Project } from \"../domain/entities/Project.ts\"\n\nexport class CreateProjectUseCase {\n  static async createProject(name: string, path: string) {\n    const project = new Project(path, name)\n    return project\n  }\n}\n","export enum EMessenger {\n  USER = \"user\",\n  SYSTEM = \"system\"\n}\n\nexport interface IMessage {\n  messenger: EMessenger,\n  content: String\n}\n\nexport class Message implements IMessage {\n  messenger: EMessenger\n  content: String\n\n  constructor({ messenger, content }: IMessage) {\n    this.messenger = messenger\n    this.content = content\n  }\n}\n","import { IProject } from \"./Project.js\"\nimport { IMessage } from \"./Message.js\";\n\nexport enum ESessionStatus {\n  ACTIVE = \"active\",\n  IDLE = \"idle\"\n}\n\nexport interface ISession {\n  status: ESessionStatus,\n  worktree: string,\n  project: IProject,\n  messages: IMessage[],\n  sendMessage(message: IMessage): void,\n  manualTakeover(): void\n}\n\nexport class Session implements ISession {\n  status: ESessionStatus\n  worktree: string\n  project: IProject\n  messages: IMessage[]\n\n  constructor(worktree: string, project: IProject) {\n    this.status = ESessionStatus.IDLE\n    this.worktree = worktree\n    this.project = project\n    this.messages = []\n  }\n\n  sendMessage(message: IMessage): void {\n    this.messages.push(message)\n  }\n\n  manualTakeover(): void {\n    // TODO\n  }\n}\n\n","import { type IProject } from \"../domain/entities/Project.js\";\nimport { Session } from \"../domain/entities/Session.js\";\n\nexport class CreateSessionUseCase {\n  static async createSession(worktree: string, project: IProject) {\n    const session = new Session(worktree, project)\n    return session\n  }\n}\n","import { query } from \"@anthropic-ai/claude-agent-sdk\"\nimport type { ISession } from \"../domain/entities/Session.ts\"\n\nexport type ClaudeEvent =\n  | { type: \"assistant_text\", text: string }\n  | { type: \"tool_call\", name: string }\n  | { type: \"done\", subtype?: string }\n  | { type: \"raw\", message: unknown }\n\nexport class ClaudeCodeGateway {\n  static async *streamMessage(session: ISession, content: string): AsyncGenerator<ClaudeEvent> {\n    for await (const message of query({\n      prompt: content,\n      options: {\n        cwd: session.project.path\n      }\n    })) {\n      if (message.type === \"assistant\" && message.message?.content) {\n        for (const block of message.message.content) {\n          if (\"text\" in block) yield { type: \"assistant_text\", text: block.text }\n          else if (\"name\" in block) yield { type: \"tool_call\", name: block.name }\n        }\n      } else if (message.type === \"result\") {\n        yield { type: \"done\", subtype: message.subtype }\n      }\n    }\n  }\n}\n\n","import { EMessenger, Message } from \"../domain/entities/Message.ts\";\nimport { ESessionStatus, type ISession } from \"../domain/entities/Session.ts\";\nimport { ClaudeCodeGateway } from \"../gateway/ClaudeCodeGateway.ts\";\n\nexport class SendMessageUseCase {\n  static async sendMessage(message: string, session: ISession) {\n    const userMessage = new Message({ messenger: EMessenger.USER, content: message })\n    session.sendMessage(userMessage)\n\n    session.status = ESessionStatus.ACTIVE\n    for await (const event of ClaudeCodeGateway.streamMessage(session, message)) {\n      if (event.type === \"assistant_text\") {\n        const systemMessage = new Message({ messenger: EMessenger.SYSTEM, content: event.text })\n        session.sendMessage(systemMessage)\n      }\n      if (event.type === \"done\") session.status = ESessionStatus.IDLE\n    }\n  }\n}\n","import os from \"node:os\"\nimport path from \"node:path\"\nimport fs from \"node:fs\"\n\nexport function normalizeCwd(p: string) {\n  const expanded =\n    p.startsWith(\"~/\") ? path.join(os.homedir(), p.slice(2)) :\n      p === \"~\" ? os.homedir() :\n        p\n\n  const abs = path.resolve(expanded)\n\n  if (!fs.existsSync(abs) || !fs.statSync(abs).isDirectory()) {\n    throw new Error(`Invalid cwd (does not exist or not a directory): ${abs}`)\n  }\n\n  return abs\n}\n","#!/usr/bin/env node\n\nimport { CreateProjectUseCase } from \"./usecase/createProjectUseCase.ts\"\nimport { CreateSessionUseCase } from \"./usecase/createSessionUseCase.js\"\nimport { SendMessageUseCase } from \"./usecase/sendMessageUseCase.js\"\nimport { normalizeCwd } from \"./utils/normalizeCwd.ts\"\n\nconst projectPath = normalizeCwd(\"~/Projects/jbeat-games/\")\nconst project = await CreateProjectUseCase.createProject(\"jbeat-games\", projectPath)\nconst session = await CreateSessionUseCase.createSession(\"test_worktree\", project)\n\nawait SendMessageUseCase.sendMessage(\"using the notion mcp, what's the title of this page https://www.notion.so/LazyStarForge-Initial-POC-2d1227e94f6180e999e2c6d5f2ea025d\", session)\n\nsession.messages.forEach((message) => {\n  console.log(message)\n})\n\nconsole.log(\"lazystarforge\")\n"],"mappings":"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","names":["path","path","project","project","project","session","session","session"]}