{"version":3,"sources":["../src/repository/orchestratorRepository.ts","../src/utils/normalizeCwd.ts","../src/domain/entities/Message.ts","../src/domain/entities/Project.ts","../src/domain/entities/ProjectManager.ts","../src/domain/entities/Session.ts","../src/domain/entities/SessionManager.ts","../src/domain/entities/Orchestrator.ts","../src/factory/orchestratorFactory.ts","../src/usecase/createProjectUseCase.ts","../src/usecase/createSessionUseCase.ts","../src/usecase/listProjectsUseCase.ts","../src/index.ts"],"sourcesContent":["import { promises as fs } from \"node:fs\"\nimport { normalizeCwd } from \"../utils/normalizeCwd.ts\"\nimport type { IOrchestrator } from \"../domain/entities/Orchestrator.ts\"\nimport type { IProject } from \"../domain/entities/Project.ts\"\nimport type { ISession } from \"../domain/entities/Session.ts\"\nimport { OrchestratorFactory } from \"../factory/orchestratorFactory.ts\"\n\nconst filePath = normalizeCwd(\"~/.lazystarforge/data\")\n\nexport class OrchestratorRepository {\n  static async find() {\n    const rawProjects = await fs.readFile(filePath + \"/projects.json\", \"utf8\")\n    const rawSessions = await fs.readFile(filePath + \"/sessions.json\", \"utf8\")\n    const projects = JSON.parse(rawProjects)\n    const sessions = JSON.parse(rawSessions)\n\n    const orchestratorFactory = new OrchestratorFactory(projects, sessions)\n    const orchestrator = orchestratorFactory.generate()\n    return orchestrator\n  }\n\n  static async save(orchestrator: IOrchestrator) {\n    const projectsJson = await this.convertOrchestratorProjectsToJson(orchestrator.listProjects())\n    const sessionsJson = await this.convertOrchestratorSessionsToJson(orchestrator.listSessions())\n    await fs.writeFile(filePath + \"/projects.json\", projectsJson, \"utf8\")\n    await fs.writeFile(filePath + \"/sessions.json\", sessionsJson, \"utf8\")\n  }\n\n  private static async convertOrchestratorProjectsToJson(projects: IProject[]) {\n    return JSON.stringify(projects, null, 2)\n  }\n\n  private static async convertOrchestratorSessionsToJson(sessions: ISession[]) {\n    return JSON.stringify(sessions, null, 2)\n  }\n}\n","import os from \"node:os\"\nimport path from \"node:path\"\nimport fs from \"node:fs\"\n\nexport function normalizeCwd(p: string) {\n  const expanded =\n    p.startsWith(\"~/\") ? path.join(os.homedir(), p.slice(2)) :\n      p === \"~\" ? os.homedir() :\n        p\n\n  const abs = path.resolve(expanded)\n\n  if (!fs.existsSync(abs) || !fs.statSync(abs).isDirectory()) {\n    throw new Error(`Invalid cwd (does not exist or not a directory): ${abs}`)\n  }\n\n  return abs\n}\n","export enum EMessenger {\n  USER = \"user\",\n  SYSTEM = \"system\"\n}\n\nexport interface IMessage {\n  messenger: EMessenger,\n  content: String\n}\n\nexport class Message implements IMessage {\n  messenger: EMessenger\n  content: String\n\n  constructor({ messenger, content }: IMessage) {\n    this.messenger = messenger\n    this.content = content\n  }\n}\n","export interface IProject {\n  name: string\n  path: string\n}\n\nexport class Project implements IProject {\n  name: string\n  path: string\n\n  constructor(path: string, name: string) {\n    this.path = path\n    this.name = name\n  }\n}\n","import { type IProject } from \"./Project.ts\"\n\nexport interface IProjectManager {\n  projects: IProject[],\n  listProjects(): IProject[],\n  addProject(project: IProject): void\n}\n\nexport class ProjectManager implements IProjectManager {\n  projects: IProject[]\n\n  constructor(projects: IProject[] = []) {\n    this.projects = projects\n  }\n\n  addProject(project: IProject): void {\n    this.projects.push(project)\n  }\n\n  listProjects(): IProject[] {\n    return this.projects\n  }\n}\n","import { type IProject } from \"./Project.ts\"\nimport { type IMessage } from \"./Message.ts\";\n\nexport enum ESessionStatus {\n  ACTIVE = \"active\",\n  IDLE = \"idle\"\n}\n\nexport interface ISession {\n  status: ESessionStatus,\n  worktree: string,\n  project: IProject,\n  messages: IMessage[],\n  sendMessage(message: IMessage): void,\n  manualTakeover(): void\n}\n\nexport class Session implements ISession {\n  status: ESessionStatus\n  worktree: string\n  project: IProject\n  messages: IMessage[]\n\n  constructor(status: ESessionStatus = ESessionStatus.IDLE, worktree: string, project: IProject, messages: IMessage[] = []) {\n    this.status = status\n    this.worktree = worktree\n    this.project = project\n    this.messages = messages\n  }\n\n  sendMessage(message: IMessage): void {\n    this.messages.push(message)\n  }\n\n  manualTakeover(): void {\n    // TODO\n  }\n}\n\n","import { type ISession } from \"./Session.ts\"\n\nexport interface ISessionManager {\n  sessions: ISession[],\n  listSessions(): ISession[],\n  addSession(session: ISession): void\n}\n\nexport class SessionManager implements ISessionManager {\n  sessions: ISession[]\n\n  constructor(sessions: ISession[] = []) {\n    this.sessions = sessions\n  }\n\n  addSession(session: ISession): void {\n    this.sessions.push(session)\n  }\n\n  listSessions(): ISession[] {\n    return this.sessions\n  }\n}\n","import { EMessenger, type IMessage, Message } from \"./Message.ts\";\nimport { type IProject, Project } from \"./Project.ts\";\nimport { type IProjectManager, ProjectManager } from \"./ProjectManager.ts\";\nimport { ESessionStatus, Session, type ISession } from \"./Session.ts\";\nimport { type ISessionManager, SessionManager } from \"./SessionManager.ts\";\n\nexport interface IOrchestrator {\n  projectManager: IProjectManager,\n  sessionManager: ISessionManager,\n  newProject(...args: ConstructorParameters<typeof Project>): void,\n  listProjects(): IProject[],\n  newSession(...args: NewSessionArgs): void,\n  listSessions(): ISession[],\n  sendMessage(session: ISession, message: string): void,\n  listMessages(session: ISession): IMessage[],\n  takeoverSession(session: ISession): void\n}\n\ntype SessionCtorArgs = ConstructorParameters<typeof Session>\ntype NewSessionArgs = [worktree: SessionCtorArgs[1], project: SessionCtorArgs[2]]\n\nexport class Orchestrator implements IOrchestrator {\n  projectManager: IProjectManager\n  sessionManager: ISessionManager\n\n  constructor(projectManager: IProjectManager = new ProjectManager, sessionManager: ISessionManager = new SessionManager) {\n    this.projectManager = projectManager\n    this.sessionManager = sessionManager\n  }\n\n  newProject(...args: ConstructorParameters<typeof Project>): void {\n    const project = new Project(...args)\n    this.projectManager.addProject(project)\n  }\n\n  listProjects(): IProject[] {\n    return this.projectManager.listProjects()\n  }\n\n  newSession(...args: NewSessionArgs): void {\n    const session = new Session(ESessionStatus.IDLE, ...args)\n    this.sessionManager.addSession(session)\n  }\n\n  listSessions(): ISession[] {\n    console.log(this)\n    console.log(this.sessionManager)\n    return this.sessionManager.listSessions()\n  }\n\n  sendMessage(session: ISession, messageContent: string): void {\n    const message = new Message({ messenger: EMessenger.USER, content: messageContent })\n    session.sendMessage(message)\n  }\n\n  listMessages(session: ISession): IMessage[] {\n    return session.messages\n  }\n\n  takeoverSession(session: ISession): void {\n    session.manualTakeover()\n  }\n}\n","import { EMessenger, Message } from \"../domain/entities/Message.ts\"\nimport { Orchestrator } from \"../domain/entities/Orchestrator.ts\"\nimport { Project } from \"../domain/entities/Project.ts\"\nimport { ProjectManager } from \"../domain/entities/ProjectManager.ts\"\nimport { ESessionStatus, Session } from \"../domain/entities/Session.ts\"\nimport { SessionManager } from \"../domain/entities/SessionManager.ts\"\n\nexport class OrchestratorFactory {\n  projectsJson: any\n  sessionsJson: any\n\n  constructor(projects: any, sessions: any) {\n    this.projectsJson = projects\n    this.sessionsJson = sessions\n  }\n\n  generate() {\n    const projects = this.parseProjects(this.projectsJson)\n    const sessions = this.parseSessions(this.sessionsJson)\n\n    return new Orchestrator(projects, sessions)\n  }\n\n  private parseProjects(projectsJson: any) {\n    const projects = projectsJson.map((json: any) => {\n      return new Project(json[\"path\"], json[\"name\"])\n    })\n\n    return new ProjectManager(projects)\n  }\n\n  private parseSessions(sessionsJson: any) {\n    const sessions = sessionsJson.map((json: any) => {\n      const status = this.parseSessionStatus(json[\"status\"])\n      const project = new Project(json[\"project\"][\"path\"], json[\"project\"][\"name\"])\n      const messages = this.parseMessages(json[\"messages\"])\n      return new Session(status, json[\"worktree\"], project, messages)\n    })\n\n    return new SessionManager(sessions)\n  }\n\n  private parseSessionStatus(input: string): ESessionStatus {\n    if ((Object.values(ESessionStatus) as string[]).includes(input)) {\n      return input as ESessionStatus\n    }\n    throw new Error(\"invalid session status\")\n  }\n\n  private parseMessages(messagesJson: any) {\n    const messages = messagesJson.map((json: any) => {\n      const messenger = this.parseMessenger(json[\"messenger\"])\n      return new Message({ messenger, content: json[\"content\"] })\n    })\n\n    return messages\n  }\n\n  private parseMessenger(input: string): EMessenger {\n    if ((Object.values(EMessenger) as string[]).includes(input)) {\n      return input as EMessenger\n    }\n    throw new Error(\"invalid messege messenger\")\n  }\n}\n","import { OrchestratorRepository } from \"../repository/orchestratorRepository.ts\"\nimport { normalizeCwd } from \"../utils/normalizeCwd.ts\"\n\nexport class CreateProjectUseCase {\n  static async createProject(name: string, path: string) {\n    const normalizedPath = normalizeCwd(path)\n    const orchestrator = await OrchestratorRepository.find()\n    orchestrator.newProject(normalizedPath, name)\n    await OrchestratorRepository.save(orchestrator)\n  }\n}\n","import { OrchestratorRepository } from \"../repository/orchestratorRepository.ts\";\n\nexport class CreateSessionUseCase {\n  static async createSession(worktree: string, projectName: string) {\n    const orchestrator = await OrchestratorRepository.find()\n    const project = orchestrator.listProjects().find((project) => {\n      return project.name === projectName\n    })\n\n    if (project === undefined) {\n      throw new Error(\"project does not exist\")\n    }\n\n    orchestrator.newSession(worktree, project)\n    await OrchestratorRepository.save(orchestrator)\n  }\n}\n","import { OrchestratorRepository } from \"../repository/orchestratorRepository.ts\";\n\nexport class ListProjectsUseCase {\n  static async listProjects() {\n    const orchestrator = await OrchestratorRepository.find()\n    const projects = orchestrator.listProjects()\n    return projects\n  }\n}\n","#!/usr/bin/env node\n\nimport { CreateProjectUseCase } from \"./usecase/createProjectUseCase.ts\"\nimport { CreateSessionUseCase } from \"./usecase/createSessionUseCase.ts\"\nimport { ListProjectsUseCase } from \"./usecase/listProjectsUseCase.ts\"\n\nawait CreateProjectUseCase.createProject(\"test\", \"~/Projects/jbeat-games/\")\nconst projects = await ListProjectsUseCase.listProjects()\nconsole.log(\"projects\")\nconsole.log(projects)\n\nawait CreateSessionUseCase.createSession(\"refactor\", \"test\")\nconst sessions = await ListProjectsUseCase.listProjects()\nconsole.log(\"sessions\")\nconsole.log(sessions)\n\nconsole.log(\"lazystarforge\")\n"],"mappings":";;;AAAA,SAAS,YAAYA,WAAU;;;ACA/B,OAAO,QAAQ;AACf,OAAO,UAAU;AACjB,OAAO,QAAQ;AAER,SAAS,aAAa,GAAW;AACtC,QAAM,WACJ,EAAE,WAAW,IAAI,IAAI,KAAK,KAAK,GAAG,QAAQ,GAAG,EAAE,MAAM,CAAC,CAAC,IACrD,MAAM,MAAM,GAAG,QAAQ,IACrB;AAEN,QAAM,MAAM,KAAK,QAAQ,QAAQ;AAEjC,MAAI,CAAC,GAAG,WAAW,GAAG,KAAK,CAAC,GAAG,SAAS,GAAG,EAAE,YAAY,GAAG;AAC1D,UAAM,IAAI,MAAM,oDAAoD,GAAG,EAAE;AAAA,EAC3E;AAEA,SAAO;AACT;;;ACjBO,IAAK,aAAL,kBAAKC,gBAAL;AACL,EAAAA,YAAA,UAAO;AACP,EAAAA,YAAA,YAAS;AAFC,SAAAA;AAAA,GAAA;AAUL,IAAM,UAAN,MAAkC;AAAA,EACvC;AAAA,EACA;AAAA,EAEA,YAAY,EAAE,WAAW,QAAQ,GAAa;AAC5C,SAAK,YAAY;AACjB,SAAK,UAAU;AAAA,EACjB;AACF;;;ACbO,IAAM,UAAN,MAAkC;AAAA,EACvC;AAAA,EACA;AAAA,EAEA,YAAYC,OAAc,MAAc;AACtC,SAAK,OAAOA;AACZ,SAAK,OAAO;AAAA,EACd;AACF;;;ACLO,IAAM,iBAAN,MAAgD;AAAA,EACrD;AAAA,EAEA,YAAYC,YAAuB,CAAC,GAAG;AACrC,SAAK,WAAWA;AAAA,EAClB;AAAA,EAEA,WAAW,SAAyB;AAClC,SAAK,SAAS,KAAK,OAAO;AAAA,EAC5B;AAAA,EAEA,eAA2B;AACzB,WAAO,KAAK;AAAA,EACd;AACF;;;ACnBO,IAAK,iBAAL,kBAAKC,oBAAL;AACL,EAAAA,gBAAA,YAAS;AACT,EAAAA,gBAAA,UAAO;AAFG,SAAAA;AAAA,GAAA;AAcL,IAAM,UAAN,MAAkC;AAAA,EACvC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YAAY,SAAyB,mBAAqB,UAAkB,SAAmB,WAAuB,CAAC,GAAG;AACxH,SAAK,SAAS;AACd,SAAK,WAAW;AAChB,SAAK,UAAU;AACf,SAAK,WAAW;AAAA,EAClB;AAAA,EAEA,YAAY,SAAyB;AACnC,SAAK,SAAS,KAAK,OAAO;AAAA,EAC5B;AAAA,EAEA,iBAAuB;AAAA,EAEvB;AACF;;;AC7BO,IAAM,iBAAN,MAAgD;AAAA,EACrD;AAAA,EAEA,YAAYC,YAAuB,CAAC,GAAG;AACrC,SAAK,WAAWA;AAAA,EAClB;AAAA,EAEA,WAAW,SAAyB;AAClC,SAAK,SAAS,KAAK,OAAO;AAAA,EAC5B;AAAA,EAEA,eAA2B;AACzB,WAAO,KAAK;AAAA,EACd;AACF;;;ACDO,IAAM,eAAN,MAA4C;AAAA,EACjD;AAAA,EACA;AAAA,EAEA,YAAY,iBAAkC,IAAI,kBAAgB,iBAAkC,IAAI,kBAAgB;AACtH,SAAK,iBAAiB;AACtB,SAAK,iBAAiB;AAAA,EACxB;AAAA,EAEA,cAAc,MAAmD;AAC/D,UAAM,UAAU,IAAI,QAAQ,GAAG,IAAI;AACnC,SAAK,eAAe,WAAW,OAAO;AAAA,EACxC;AAAA,EAEA,eAA2B;AACzB,WAAO,KAAK,eAAe,aAAa;AAAA,EAC1C;AAAA,EAEA,cAAc,MAA4B;AACxC,UAAM,UAAU,IAAI,2BAA6B,GAAG,IAAI;AACxD,SAAK,eAAe,WAAW,OAAO;AAAA,EACxC;AAAA,EAEA,eAA2B;AACzB,YAAQ,IAAI,IAAI;AAChB,YAAQ,IAAI,KAAK,cAAc;AAC/B,WAAO,KAAK,eAAe,aAAa;AAAA,EAC1C;AAAA,EAEA,YAAY,SAAmB,gBAA8B;AAC3D,UAAM,UAAU,IAAI,QAAQ,EAAE,8BAA4B,SAAS,eAAe,CAAC;AACnF,YAAQ,YAAY,OAAO;AAAA,EAC7B;AAAA,EAEA,aAAa,SAA+B;AAC1C,WAAO,QAAQ;AAAA,EACjB;AAAA,EAEA,gBAAgB,SAAyB;AACvC,YAAQ,eAAe;AAAA,EACzB;AACF;;;ACvDO,IAAM,sBAAN,MAA0B;AAAA,EAC/B;AAAA,EACA;AAAA,EAEA,YAAYC,WAAeC,WAAe;AACxC,SAAK,eAAeD;AACpB,SAAK,eAAeC;AAAA,EACtB;AAAA,EAEA,WAAW;AACT,UAAMD,YAAW,KAAK,cAAc,KAAK,YAAY;AACrD,UAAMC,YAAW,KAAK,cAAc,KAAK,YAAY;AAErD,WAAO,IAAI,aAAaD,WAAUC,SAAQ;AAAA,EAC5C;AAAA,EAEQ,cAAc,cAAmB;AACvC,UAAMD,YAAW,aAAa,IAAI,CAAC,SAAc;AAC/C,aAAO,IAAI,QAAQ,KAAK,MAAM,GAAG,KAAK,MAAM,CAAC;AAAA,IAC/C,CAAC;AAED,WAAO,IAAI,eAAeA,SAAQ;AAAA,EACpC;AAAA,EAEQ,cAAc,cAAmB;AACvC,UAAMC,YAAW,aAAa,IAAI,CAAC,SAAc;AAC/C,YAAM,SAAS,KAAK,mBAAmB,KAAK,QAAQ,CAAC;AACrD,YAAM,UAAU,IAAI,QAAQ,KAAK,SAAS,EAAE,MAAM,GAAG,KAAK,SAAS,EAAE,MAAM,CAAC;AAC5E,YAAM,WAAW,KAAK,cAAc,KAAK,UAAU,CAAC;AACpD,aAAO,IAAI,QAAQ,QAAQ,KAAK,UAAU,GAAG,SAAS,QAAQ;AAAA,IAChE,CAAC;AAED,WAAO,IAAI,eAAeA,SAAQ;AAAA,EACpC;AAAA,EAEQ,mBAAmB,OAA+B;AACxD,QAAK,OAAO,OAAO,cAAc,EAAe,SAAS,KAAK,GAAG;AAC/D,aAAO;AAAA,IACT;AACA,UAAM,IAAI,MAAM,wBAAwB;AAAA,EAC1C;AAAA,EAEQ,cAAc,cAAmB;AACvC,UAAM,WAAW,aAAa,IAAI,CAAC,SAAc;AAC/C,YAAM,YAAY,KAAK,eAAe,KAAK,WAAW,CAAC;AACvD,aAAO,IAAI,QAAQ,EAAE,WAAW,SAAS,KAAK,SAAS,EAAE,CAAC;AAAA,IAC5D,CAAC;AAED,WAAO;AAAA,EACT;AAAA,EAEQ,eAAe,OAA2B;AAChD,QAAK,OAAO,OAAO,UAAU,EAAe,SAAS,KAAK,GAAG;AAC3D,aAAO;AAAA,IACT;AACA,UAAM,IAAI,MAAM,2BAA2B;AAAA,EAC7C;AACF;;;ARzDA,IAAM,WAAW,aAAa,uBAAuB;AAE9C,IAAM,yBAAN,MAA6B;AAAA,EAClC,aAAa,OAAO;AAClB,UAAM,cAAc,MAAMC,IAAG,SAAS,WAAW,kBAAkB,MAAM;AACzE,UAAM,cAAc,MAAMA,IAAG,SAAS,WAAW,kBAAkB,MAAM;AACzE,UAAMC,YAAW,KAAK,MAAM,WAAW;AACvC,UAAMC,YAAW,KAAK,MAAM,WAAW;AAEvC,UAAM,sBAAsB,IAAI,oBAAoBD,WAAUC,SAAQ;AACtE,UAAM,eAAe,oBAAoB,SAAS;AAClD,WAAO;AAAA,EACT;AAAA,EAEA,aAAa,KAAK,cAA6B;AAC7C,UAAM,eAAe,MAAM,KAAK,kCAAkC,aAAa,aAAa,CAAC;AAC7F,UAAM,eAAe,MAAM,KAAK,kCAAkC,aAAa,aAAa,CAAC;AAC7F,UAAMF,IAAG,UAAU,WAAW,kBAAkB,cAAc,MAAM;AACpE,UAAMA,IAAG,UAAU,WAAW,kBAAkB,cAAc,MAAM;AAAA,EACtE;AAAA,EAEA,aAAqB,kCAAkCC,WAAsB;AAC3E,WAAO,KAAK,UAAUA,WAAU,MAAM,CAAC;AAAA,EACzC;AAAA,EAEA,aAAqB,kCAAkCC,WAAsB;AAC3E,WAAO,KAAK,UAAUA,WAAU,MAAM,CAAC;AAAA,EACzC;AACF;;;AShCO,IAAM,uBAAN,MAA2B;AAAA,EAChC,aAAa,cAAc,MAAcC,OAAc;AACrD,UAAM,iBAAiB,aAAaA,KAAI;AACxC,UAAM,eAAe,MAAM,uBAAuB,KAAK;AACvD,iBAAa,WAAW,gBAAgB,IAAI;AAC5C,UAAM,uBAAuB,KAAK,YAAY;AAAA,EAChD;AACF;;;ACRO,IAAM,uBAAN,MAA2B;AAAA,EAChC,aAAa,cAAc,UAAkB,aAAqB;AAChE,UAAM,eAAe,MAAM,uBAAuB,KAAK;AACvD,UAAM,UAAU,aAAa,aAAa,EAAE,KAAK,CAACC,aAAY;AAC5D,aAAOA,SAAQ,SAAS;AAAA,IAC1B,CAAC;AAED,QAAI,YAAY,QAAW;AACzB,YAAM,IAAI,MAAM,wBAAwB;AAAA,IAC1C;AAEA,iBAAa,WAAW,UAAU,OAAO;AACzC,UAAM,uBAAuB,KAAK,YAAY;AAAA,EAChD;AACF;;;ACdO,IAAM,sBAAN,MAA0B;AAAA,EAC/B,aAAa,eAAe;AAC1B,UAAM,eAAe,MAAM,uBAAuB,KAAK;AACvD,UAAMC,YAAW,aAAa,aAAa;AAC3C,WAAOA;AAAA,EACT;AACF;;;ACFA,MAAM,qBAAqB,cAAc,QAAQ,yBAAyB;AAC1E,IAAM,WAAW,MAAM,oBAAoB,aAAa;AACxD,QAAQ,IAAI,UAAU;AACtB,QAAQ,IAAI,QAAQ;AAEpB,MAAM,qBAAqB,cAAc,YAAY,MAAM;AAC3D,IAAM,WAAW,MAAM,oBAAoB,aAAa;AACxD,QAAQ,IAAI,UAAU;AACtB,QAAQ,IAAI,QAAQ;AAEpB,QAAQ,IAAI,eAAe;","names":["fs","EMessenger","path","projects","ESessionStatus","sessions","projects","sessions","fs","projects","sessions","path","project","projects"]}